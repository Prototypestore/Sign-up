// Preloader logic
window.addEventListener("load", () => {
  const spinner = document.querySelector(".spinner");
  const chibi = document.getElementById("chibi");
  const nextButton = document.getElementById("nextButton");

  // Trigger burst animation on spinner
  spinner.classList.add("burst");

  // After burst, hide spinner and fade in chibi + Next button
  setTimeout(() => {
    spinner.style.display = "none";
    chibi.style.display = "block";
    setTimeout(() => chibi.style.opacity = "1", 50); // fade in
    nextButton.style.display = "block";
  }, 600); // matches burst duration
});

// When Next is clicked, hide preloader and reveal login page
document.getElementById("nextButton").addEventListener("click", () => {
  document.getElementById("preloader").style.display = "none";
  document.querySelector(".container").style.display = "flex";
});

// Interactive chibi logic
let leftEye = document.getElementById('leftEye');
let rightEye = document.getElementById('rightEye');
const leftEarOuter = document.getElementById('leftEarOuter');
const rightEarOuter = document.getElementById('rightEarOuter');
const loginForm = document.querySelector('form');
const face = document.querySelector('.container svg');

const isDesktop = window.matchMedia("(min-width: 768px)").matches;

if (isDesktop) {
  document.addEventListener('mousemove', (e) => {
    const rect = face.getBoundingClientRect();
    const faceCenterX = rect.left + rect.width / 2;
    const faceCenterY = rect.top + rect.height / 2;

    const dx = (e.clientX - faceCenterX) / 40;
    const dy = (e.clientY - faceCenterY) / 40;

    const formRect = loginForm.getBoundingClientRect();
    const distanceX = Math.abs(e.clientX - (formRect.left + formRect.width / 2));
    const distanceY = Math.abs(e.clientY - (formRect.top + formRect.height / 2));
    const closeEnough = distanceX < formRect.width / 2 + 50 && distanceY < formRect.height / 2 + 50;

    if (closeEnough) {
      leftEye.outerHTML = '<text id="leftEye" class="eye heart-eye" x="75" y="95" font-size="20">❤️</text>';
      rightEye.outerHTML = '<text id="rightEye" class="eye heart-eye" x="115" y="95" font-size="20">❤️</text>';

      leftEye = document.getElementById('leftEye');
      rightEye = document.getElementById('rightEye');

      leftEarOuter.classList.add('wiggle');
      rightEarOuter.classList.add('wiggle');
    } else {
      leftEye.outerHTML = `<ellipse id="leftEye" class="eye" cx="${80 + dx}" cy="${90 + dy}" rx="10" ry="14" fill="black"/>`;
      rightEye.outerHTML = `<ellipse id="rightEye" class="eye" cx="${120 + dx}" cy="${90 + dy}" rx="10" ry="14" fill="black"/>`;

      leftEye = document.getElementById('leftEye');
      rightEye = document.getElementById('rightEye');

      leftEarOuter.classList.remove('wiggle');
      rightEarOuter.classList.remove('wiggle');
    }
  });
}

// Wiggle ears every 3 seconds
function wiggleEars() {
  leftEarOuter.classList.add('wiggle');
  rightEarOuter.classList.add('wiggle');
  setTimeout(() => {
    leftEarOuter.classList.remove('wiggle');
    rightEarOuter.classList.remove('wiggle');
  }, 500);
}
setInterval(wiggleEars, 3000);
